
# -*- coding: utf-8 -*-

import png
import imglib
import ppmlib

#file = open("00.png", "rb")
file = open("200908111530-00.png", "rb")
bin  = file.read()
png  = png.Png8bitPalette.load(bin)
width  = png.bitmap.width
height = png.bitmap.height

bitmap = imglib.RgbBitmap(width, height)
for y in range(height):
  for x in range(width):
    rgb = png.get_color((x, y))
    bitmap.set_pixel(x, y, rgb)

ctable = {
  (255,   0,   0): (255,   0,   0), # 80mm/h ˆÈã
  (255,   0, 255): (255,   0, 255), # 50-80mm/h
  (255, 153,   0): (255, 153,   0), # 30-50mm/h
  (255, 255,   0): (255, 255,   0), # 20-30mm/h
  (  0, 255,   0): (  0, 255,   0), # 10-20mm/h
  (  0,   0, 255): (  0,   0, 255), #  5-10mm/h
  ( 51, 102, 255): ( 51, 102, 255), #  1- 5mm/h
  (153, 204, 255): (153, 204, 255), #  0- 1mm/h

  ( 96,  57,  19): ( 96,  57,  19), # ŠÏ‘ª“_
  (230, 230, 230): (255, 255, 255), # “s“¹•{Œ§‹«ŠE
  (255, 255, 255): (255, 255, 255), # ŠCŠÝ‹«ŠE
  (102, 102, 102): (102, 102, 102), # ŠCŠÝ‹«ŠE/ƒOƒŠƒbƒh

  (116, 123, 114): (116, 123, 114), # ŠCŠÝ‹«ŠE
  (160, 160, 160): (160, 160, 160), # ŠCŠÝ‹«ŠE

  (184, 184, 228): (184, 184, 228), # ŠC
  (193, 193, 193): (193, 193, 193), # ŠC

  (117, 141, 201): (117, 141, 201), # ŒÎ
  (134, 164, 205): (134, 164, 205), # ŒÎ
  (136, 166, 207): (136, 166, 207), # ŒÎ
  (141, 172, 210): (141, 172, 210), # ŒÎ
  (143, 173, 210): (143, 173, 210), # ŒÎ
  (144, 173, 211): (144, 173, 211), # ŒÎ
  (145, 176, 210): (145, 176, 210), # ŒÎ
  (184, 184, 228): (184, 184, 228), # ŒÎ

  ( 92, 115, 159): ( 92, 115, 159), # ŒÎ‹«ŠE
  ( 94, 117, 158): ( 94, 117, 158), # ŒÎ‹«ŠE
  (102, 125, 145): (102, 125, 145), # ŒÎ‹«ŠE
  (112, 138, 162): (112, 138, 162), # ŒÎ‹«ŠE
  (114, 141, 159): (114, 141, 159), # ŒÎ‹«ŠE
  (114, 142, 169): (141, 142, 169), # ŒÎ‹«ŠE
  (115, 141, 183): (115, 141, 183), # ŒÎ‹«ŠE
  (118, 146, 175): (118, 146, 175), # ŒÎ‹«ŠE
  (126, 156, 187): (126, 156, 187), # ŒÎ‹«ŠE
  (128, 158, 192): (128, 158, 192), # ŒÎ‹«ŠE
  (142, 173, 180): (142, 173, 180), # ŒÎ‹«ŠE
  (151, 181, 180): (151, 181, 180), # ŒÎ‹«ŠE

  (125, 158, 142): (125, 158, 142), # ŒÎ‹«ŠE
  (137, 170, 168): (137, 170, 168), # ŒÎ‹«ŠE

  (109, 141,  94): (109, 141,  94), # ‘å’n
  (117, 150, 102): (117, 150, 102), # ‘å’n
  (118, 152, 102): (118, 152, 102), # ‘å’n
  (118, 153, 102): (118, 153, 102), # ‘å’n
  (120, 149, 132): (120, 149, 132), # ‘å’n
  (122, 157, 107): (122, 157, 107), # ‘å’n
  (125, 161, 108): (125, 161, 108), # ‘å’n
  (125, 161, 109): (125, 161, 109), # ‘å’n
  (127, 163, 111): (127, 163, 111), # ‘å’n
  (128, 163, 111): (128, 163, 111), # ‘å’n
  (129, 158, 146): (129, 158, 146), # ‘å’n
  (129, 165, 112): (129, 165, 112), # ‘å’n
  (130, 165, 113): (130, 165, 113), # ‘å’n
  (132, 163, 155): (132, 163, 155), # ‘å’n
  (132, 167, 115): (132, 167, 115), # ‘å’n
  (132, 168, 115): (132, 168, 115), # ‘å’n
  (133, 168, 116): (133, 168, 116), # ‘å’n
  (134, 169, 117): (134, 169, 117), # ‘å’n
  (135, 170, 118): (135, 170, 118), # ‘å’n
  (136, 168, 155): (136, 168, 155), # ‘å’n
  (136, 171, 120): (136, 171, 120), # ‘å’n
  (137, 169, 158): (137, 169, 158), # ‘å’n
  (138, 172, 121): (138, 172, 121), # ‘å’n
  (139, 173, 122): (139, 173, 122), # ‘å’n
  (140, 174, 125): (140, 174, 125), # ‘å’n
  (140, 175, 124): (140, 175, 124), # ‘å’n
  (141, 174, 126): (141, 174, 126), # ‘å’n
  (142, 175, 127): (142, 175, 127), # ‘å’n
  (143, 176, 128): (143, 176, 128), # ‘å’n
  (144, 172, 137): (144, 172, 137), # ‘å’n
  (144, 176, 128): (144, 176, 128), # ‘å’n
  (146, 174, 143): (146, 174, 143), # ‘å’n
  (146, 178, 131): (146, 178, 131), # ‘å’n
  (147, 178, 131): (147, 178, 131), # ‘å’n
  (148, 178, 156): (148, 178, 156), # ‘å’n
  (151, 181, 136): (151, 181, 136), # ‘å’n
  (151, 182, 136): (151, 182, 136), # ‘å’n
  (156, 185, 142): (156, 185, 142), # ‘å’n
  (157, 186, 143): (157, 186, 143), # ‘å’n
  (158, 185, 189): (158, 185, 189), # ‘å’n
  (159, 187, 145): (159, 187, 145), # ‘å’n
  (161, 189, 147): (161, 189, 147), # ‘å’n
  (161, 189, 148): (161, 189, 148), # ‘å’n
  (163, 191, 151): (163, 191, 151), # ‘å’n
  (164, 191, 151): (164, 191, 151), # ‘å’n
}

missing = {}

for y in range(bitmap.height):
  for x in range(bitmap.width):
    rgb1 = bitmap.get_pixel(x, y)
    rgb2 = ctable.get(rgb1, (255, 128, 255))
    if ctable.get(rgb1) == None:
      missing[rgb1] = missing.get(rgb1, 0) + 1

    bitmap.set_pixel(x, y, rgb2)

outfile = open("tmp.ppm", "wb")
ppm = ppmlib.PpmWriter(bitmap)
ppm.write(outfile)
outfile.close()

def cmp(a, b):
  argb, ac = a
  brgb, bc = b
  return ac - bc
missing = missing.items()
missing.sort(cmp)
for (rgb, count) in missing:
  r, g, b = rgb
  #if g > r and g > b:
  if b > r and b > g:
    print (rgb, count)
